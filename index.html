<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ å¯»è·¯å°è¾¾äºº - A*ç®—æ³•æ¢é™©</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-light: #faf5ff;
            --bg-dark: #1e1b4b;
            --text-light: #1e1b4b;
            --text-dark: #f5f3ff;
            --card-light: #ffffff;
            --card-dark: #312e81;
            --cell-empty: #e0e7ff;
            --cell-empty-dark: #3730a3;
            --cell-wall: #475569;
            --cell-wall-dark: #1e293b;
            --cell-start: #22c55e;
            --cell-end: #ef4444;
            --cell-open: #fbbf24;
            --cell-closed: #a78bfa;
            --cell-path: #34d399;
            --cell-current: #f472b6;
        }

        .dark {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --card: var(--card-dark);
            --cell-empty-current: var(--cell-empty-dark);
        }

        :root:not(.dark) {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --card: var(--card-light);
            --cell-empty-current: var(--cell-empty);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .bg-pattern {
            position: fixed;
            inset: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.08) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr 320px;
            }
        }

        .card {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.15);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #34d399);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #fbbf24);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #f87171);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .diff-btn {
            padding: 10px 20px;
            border: 3px solid transparent;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--cell-empty-current);
        }

        .diff-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .diff-btn:hover:not(.active) {
            border-color: var(--primary-light);
        }

        .grid-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .grid {
            display: grid;
            gap: 3px;
            background: rgba(99, 102, 241, 0.2);
            padding: 10px;
            border-radius: 15px;
        }

        .cell {
            width: clamp(35px, 8vw, 55px);
            height: clamp(35px, 8vw, 55px);
            background: var(--cell-empty-current);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .cell.wall {
            background: var(--cell-wall);
        }

        .dark .cell.wall {
            background: var(--cell-wall-dark);
        }

        .cell.start {
            background: linear-gradient(135deg, var(--cell-start), #4ade80);
        }

        .cell.end {
            background: linear-gradient(135deg, var(--cell-end), #f87171);
        }

        .cell.open {
            background: linear-gradient(135deg, var(--cell-open), #fcd34d);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 0 8px rgba(251, 191, 36, 0); }
        }

        .cell.closed {
            background: linear-gradient(135deg, var(--cell-closed), #c4b5fd);
        }

        .cell.path {
            background: linear-gradient(135deg, var(--cell-path), #6ee7b7);
            animation: pathGlow 0.5s ease-out;
        }

        @keyframes pathGlow {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .cell.current {
            background: linear-gradient(135deg, var(--cell-current), #f9a8d4);
            animation: currentPulse 0.5s ease-out;
        }

        @keyframes currentPulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 114, 182, 0.7); }
            100% { box-shadow: 0 0 0 10px rgba(244, 114, 182, 0); }
        }

        .cell-icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        .cell-values {
            font-size: 0.55rem;
            opacity: 0.9;
            text-align: center;
            line-height: 1.2;
        }

        .cell.start .cell-values,
        .cell.end .cell-values {
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .sidebar h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .info-box {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .info-box h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .info-box p {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .formula {
            background: var(--card);
            border: 2px dashed var(--primary);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .formula span {
            color: var(--primary);
        }

        .estimate-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), #fbbf24);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 700;
            vertical-align: middle;
            margin-left: 4px;
        }

        .step-info {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 80px;
        }

        .step-info h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-counter {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-item {
            background: rgba(99, 102, 241, 0.1);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .speed-control label {
            font-weight: 600;
        }

        .speed-control input[type="range"] {
            flex: 1;
            min-width: 100px;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .modal p {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal .btn {
            margin: 5px;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .thinking-bubble {
            position: absolute;
            background: white;
            color: #333;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 100;
            white-space: nowrap;
            animation: bubbleIn 0.3s ease-out;
        }

        @keyframes bubbleIn {
            from { opacity: 0; transform: scale(0.5) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .help-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            z-index: 100;
            transition: transform 0.3s;
        }

        .help-toggle:hover {
            transform: scale(1.1);
        }

        /* Mode Toggle Styles */
        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 3px solid var(--cell-empty-current);
            border-radius: 30px;
            font-family: inherit;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--cell-empty-current);
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .mode-btn:hover:not(.active) {
            border-color: var(--primary-light);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Edit Toolbar Styles */
        .edit-toolbar {
            background: rgba(99, 102, 241, 0.1);
            border: 2px dashed var(--primary);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .edit-toolbar.visible {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toolbar-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--primary);
            text-align: center;
        }

        .tool-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 10px 15px;
            border: 3px solid transparent;
            border-radius: 12px;
            background: var(--card);
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px;
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tool-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(129, 140, 248, 0.2));
        }

        .tool-icon {
            font-size: 1.5rem;
        }

        .tool-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
        }

        .edit-hint {
            text-align: center;
            font-size: 0.85rem;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
            display: block;
            margin: 0 auto;
        }

        /* Edit mode cell styles */
        .edit-mode .cell {
            cursor: crosshair;
        }

        .edit-mode .cell:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        .cell.preview-wall {
            background: rgba(71, 85, 105, 0.5) !important;
        }

        .cell.preview-start {
            background: rgba(34, 197, 94, 0.5) !important;
        }

        .cell.preview-end {
            background: rgba(239, 68, 68, 0.5) !important;
        }

        .cell.preview-eraser {
            background: rgba(255, 255, 255, 0.5) !important;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--danger);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        footer {
            text-align: center;
            margin-top: 30px;
            opacity: 0.6;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .card {
                padding: 15px;
            }

            .controls {
                gap: 8px;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .legend {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <div class="container">
        <header>
            <h1>ğŸŒŸ å¯»è·¯å°è¾¾äºº - A*ç®—æ³•æ¢é™©</h1>
            <p class="subtitle">è·Ÿç€å°æœºå™¨äººå­¦ä¹ æœ€èªæ˜çš„å¯»è·¯æ–¹æ³•ï¼</p>
        </header>

        <div class="main-layout">
            <div class="card game-area">
                <div class="difficulty-selector">
                    <button class="diff-btn active" data-level="easy">ğŸŒ± ç®€å• (5Ã—5)</button>
                    <button class="diff-btn" data-level="medium">ğŸŒ¿ ä¸­ç­‰ (7Ã—7)</button>
                    <button class="diff-btn" data-level="hard">ğŸŒ³ å›°éš¾ (9Ã—9)</button>
                </div>

                <!-- Edit Mode Toggle -->
                <div class="mode-toggle">
                    <button class="mode-btn active" id="playModeBtn">
                        <i class="fas fa-play-circle"></i> æ¼”ç¤ºæ¨¡å¼
                    </button>
                    <button class="mode-btn" id="editModeBtn">
                        <i class="fas fa-edit"></i> ç¼–è¾‘æ¨¡å¼
                    </button>
                </div>

                <!-- Edit Toolbar -->
                <div class="edit-toolbar" id="editToolbar">
                    <div class="toolbar-title"><i class="fas fa-tools"></i> ç¼–è¾‘å·¥å…·</div>
                    <div class="tool-buttons">
                        <button class="tool-btn active" data-tool="wall" title="æ”¾ç½®/ç§»é™¤éšœç¢ç‰©">
                            <span class="tool-icon">ğŸ§±</span>
                            <span class="tool-label">éšœç¢ç‰©</span>
                        </button>
                        <button class="tool-btn" data-tool="start" title="è®¾ç½®èµ·ç‚¹">
                            <span class="tool-icon">ğŸ¤–</span>
                            <span class="tool-label">èµ·ç‚¹</span>
                        </button>
                        <button class="tool-btn" data-tool="end" title="è®¾ç½®ç»ˆç‚¹">
                            <span class="tool-icon">ğŸ </span>
                            <span class="tool-label">ç»ˆç‚¹</span>
                        </button>
                        <button class="tool-btn" data-tool="eraser" title="æ©¡çš®æ“¦">
                            <span class="tool-icon">ğŸ§¹</span>
                            <span class="tool-label">æ©¡çš®æ“¦</span>
                        </button>
                    </div>
                    <div class="edit-hint">
                        <i class="fas fa-info-circle"></i>
                        <span id="editHintText">ç‚¹å‡»æˆ–æ‹–åŠ¨æ¥æ”¾ç½®/ç§»é™¤éšœç¢ç‰©</span>
                    </div>
                    <button class="btn btn-danger btn-small" id="clearAllBtn">
                        <i class="fas fa-trash"></i> æ¸…ç©ºéšœç¢ç‰©
                    </button>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" id="newPuzzle">
                        <i class="fas fa-dice"></i> æ–°é¢˜ç›®
                    </button>
                    <button class="btn btn-success" id="startBtn">
                        <i class="fas fa-play"></i> å¼€å§‹æ¼”ç¤º
                    </button>
                    <button class="btn btn-primary" id="stepBtn" disabled>
                        <i class="fas fa-step-forward"></i> ä¸‹ä¸€æ­¥
                    </button>
                    <button class="btn btn-danger" id="resetBtn">
                        <i class="fas fa-redo"></i> é‡ç½®
                    </button>
                </div>

                <div class="grid-container">
                    <div class="grid" id="grid"></div>
                </div>

                <div class="step-info" id="stepInfo">
                    <h4><i class="fas fa-lightbulb"></i> å‡†å¤‡å¼€å§‹</h4>
                    <p>ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"ï¼Œç„¶åç‚¹å‡»"ä¸‹ä¸€æ­¥"æ¥é€æ­¥è§‚å¯ŸA*ç®—æ³•æ˜¯å¦‚ä½•æ‰¾åˆ°æœ€çŸ­è·¯å¾„çš„ï¼</p>
                </div>

                <div class="speed-control">
                    <label><i class="fas fa-tachometer-alt"></i> æ¼”ç¤ºé€Ÿåº¦:</label>
                    <input type="range" id="speedSlider" min="100" max="1500" value="800">
                    <span id="speedLabel">ä¸­é€Ÿ</span>
                </div>
            </div>

            <div class="sidebar">
                <div class="card">
                    <h3><i class="fas fa-map-signs"></i> å›¾ä¾‹è¯´æ˜</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #22c55e, #4ade80);"></div>
                            <span>ğŸ¤– èµ·ç‚¹</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ef4444, #f87171);"></div>
                            <span>ğŸ  ç»ˆç‚¹</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #475569;"></div>
                            <span>ğŸ§± éšœç¢ç‰©</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #fbbf24, #fcd34d);"></div>
                            <span>ğŸ“‹ å¾…æ¢ç´¢</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #a78bfa, #c4b5fd);"></div>
                            <span>âœ… å·²æ¢ç´¢</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #f472b6, #f9a8d4);"></div>
                            <span>ğŸ‘€ å½“å‰ä½ç½®</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #34d399, #6ee7b7);"></div>
                            <span>â­ æœ€çŸ­è·¯å¾„</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-brain"></i> A*ç®—æ³•å°è¯¾å ‚</h3>
                    <div class="info-box">
                        <h4>ğŸ¯ æ ¸å¿ƒå…¬å¼</h4>
                        <div class="formula">
                            <span>f</span> = <span>g</span> + <span>h*</span>
                        </div>
                        <p>
                            <strong>gå€¼</strong>ï¼šä»èµ·ç‚¹èµ°åˆ°è¿™é‡Œ<em>å®é™…</em>èŠ±äº†å¤šå°‘æ­¥ âœ“<br>
                            <strong>h*å€¼</strong>ï¼š<em>çŒœæµ‹</em>ä»è¿™é‡Œåˆ°ç»ˆç‚¹è¿˜è¦èµ°å¤šå°‘æ­¥ <span class="estimate-badge">ä¼°è®¡</span><br>
                            <strong>få€¼</strong>ï¼šæ€»å…±<em>é¢„è®¡</em>è¦èµ°å¤šå°‘æ­¥
                        </p>
                    </div>
                    <div class="info-box">
                        <h4>ğŸ¤” h*æ˜¯æ€ä¹ˆçŒœçš„ï¼Ÿ</h4>
                        <p>h*ç”¨çš„æ˜¯<strong>æ›¼å“ˆé¡¿è·ç¦»</strong>ï¼šå‡è£…æ²¡æœ‰éšœç¢ç‰©ï¼Œåªèƒ½ä¸Šä¸‹å·¦å³èµ°ï¼Œæ•°ä¸€æ•°æœ€å°‘è¦å‡ æ­¥ã€‚<br><br>
                        âš ï¸ <strong>æ³¨æ„</strong>ï¼šå› ä¸ºå¿½ç•¥äº†éšœç¢ç‰©ï¼Œæ‰€ä»¥h*å¯èƒ½æ¯”å®é™…è·ç¦»<strong>æ›´çŸ­</strong>ï¼ˆä¹è§‚ä¼°è®¡ï¼‰ï¼è¿™æ ·èƒ½ä¿è¯æ‰¾åˆ°çš„è·¯å¾„ä¸€å®šæ˜¯æœ€çŸ­çš„ã€‚</p>
                    </div>
                    <div class="info-box">
                        <h4>ğŸ’¡ èªæ˜çš„ç§˜è¯€</h4>
                        <p>A*ç®—æ³•æ¯æ¬¡éƒ½é€‰æ‹©<strong>få€¼æœ€å°</strong>çš„æ ¼å­æ¥æ¢ç´¢ã€‚å› ä¸ºh*æ˜¯ä¹è§‚ä¼°è®¡ï¼Œæ‰€ä»¥ä¸ä¼šé”™è¿‡çœŸæ­£çš„æœ€çŸ­è·¯å¾„ï¼</p>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-chart-bar"></i> ç»Ÿè®¡æ•°æ®</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="stepsCount">0</div>
                            <div class="stat-label">æ¢ç´¢æ­¥æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pathLength">-</div>
                            <div class="stat-label">è·¯å¾„é•¿åº¦</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="openCount">0</div>
                            <div class="stat-label">å¾…æ¢ç´¢</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="closedCount">0</div>
                            <div class="stat-label">å·²æ¢ç´¢</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>ğŸ® é€šè¿‡ç©è€å­¦ä¹ äººå·¥æ™ºèƒ½çš„åŸºç¡€çŸ¥è¯† | A*ç®—æ³•æ¢é™©</p>
        </footer>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="success-icon">ğŸ‰</div>
            <h2>å¤ªæ£’äº†ï¼</h2>
            <p id="successMessage">æœºå™¨äººæ‰¾åˆ°äº†æœ€çŸ­è·¯å¾„ï¼</p>
            <button class="btn btn-primary" onclick="closeModal()">
                <i class="fas fa-thumbs-up"></i> ç»§ç»­æ¢ç´¢
            </button>
            <button class="btn btn-secondary" onclick="closeModal(); generateNewPuzzle();">
                <i class="fas fa-dice"></i> æ–°é¢˜ç›®
            </button>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <h2>ğŸ¤” å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2>
            <p style="text-align: left;">
                <strong>ğŸ“º æ¼”ç¤ºæ¨¡å¼</strong><br>
                1ï¸âƒ£ é€‰æ‹©éš¾åº¦çº§åˆ«<br>
                2ï¸âƒ£ ç‚¹å‡»"æ–°é¢˜ç›®"ç”Ÿæˆè¿·å®«<br>
                3ï¸âƒ£ ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"åˆå§‹åŒ–ç®—æ³•<br>
                4ï¸âƒ£ ç‚¹å‡»"ä¸‹ä¸€æ­¥"è§‚å¯Ÿæ¯ä¸€æ­¥<br>
                5ï¸âƒ£ è§‚å¯Ÿæ ¼å­ä¸Šçš„æ•°å­—ï¼š<br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ä¸Šé¢çš„æ•°å­—æ˜¯ <strong>få€¼</strong><br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ä¸‹é¢æ˜¯ <strong>g+h</strong> çš„åˆ†è§£<br><br>
                <strong>âœï¸ ç¼–è¾‘æ¨¡å¼</strong><br>
                1ï¸âƒ£ ç‚¹å‡»"ç¼–è¾‘æ¨¡å¼"æŒ‰é’®<br>
                2ï¸âƒ£ é€‰æ‹©å·¥å…·ï¼š<br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ğŸ§± éšœç¢ç‰©ï¼šç‚¹å‡»æ”¾ç½®/ç§»é™¤<br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ğŸ¤– èµ·ç‚¹ï¼šç‚¹å‡»è®¾ç½®æ–°èµ·ç‚¹<br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ğŸ  ç»ˆç‚¹ï¼šç‚¹å‡»è®¾ç½®æ–°ç»ˆç‚¹<br>
                &nbsp;&nbsp;&nbsp;&nbsp;â€¢ ğŸ§¹ æ©¡çš®æ“¦ï¼šæ¸…é™¤éšœç¢ç‰©<br>
                3ï¸âƒ£ æ‹–åŠ¨å¯ä»¥è¿ç»­æ”¾ç½®éšœç¢ç‰©<br>
                4ï¸âƒ£ ç¼–è¾‘å®Œæˆååˆ‡å›æ¼”ç¤ºæ¨¡å¼
            </p>
            <button class="btn btn-primary" onclick="closeHelpModal()">
                <i class="fas fa-check"></i> æ˜ç™½äº†ï¼
            </button>
        </div>
    </div>

    <button class="help-toggle" onclick="showHelpModal()">
        <i class="fas fa-question"></i>
    </button>

    <!-- Toast Container -->
    <div class="toast" id="toast"></div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Game state
        let gridSize = 5;
        let grid = [];
        let start = null;
        let end = null;
        let openList = [];
        let closedList = [];
        let currentNode = null;
        let isRunning = false;
        let isComplete = false;
        let stepCount = 0;
        let animationSpeed = 800;
        let isEditMode = false;
        let currentTool = 'wall';
        let isMouseDown = false;

        // DOM elements
        const gridEl = document.getElementById('grid');
        const stepInfo = document.getElementById('stepInfo');
        const startBtn = document.getElementById('startBtn');
        const stepBtn = document.getElementById('stepBtn');
        const resetBtn = document.getElementById('resetBtn');
        const newPuzzleBtn = document.getElementById('newPuzzle');
        const speedSlider = document.getElementById('speedSlider');
        const speedLabel = document.getElementById('speedLabel');

        // Difficulty settings
        const difficulties = {
            easy: { size: 5, walls: 4 },
            medium: { size: 7, walls: 10 },
            hard: { size: 9, walls: 18 }
        };

        let currentDifficulty = 'easy';

        // Initialize
        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.level;
                generateNewPuzzle();
            });
        });

        speedSlider.addEventListener('input', () => {
            animationSpeed = 1600 - parseInt(speedSlider.value);
            const labels = ['å¾ˆæ…¢', 'æ…¢é€Ÿ', 'ä¸­é€Ÿ', 'å¿«é€Ÿ', 'å¾ˆå¿«'];
            const index = Math.floor((parseInt(speedSlider.value) - 100) / 350);
            speedLabel.textContent = labels[Math.min(index, 4)];
        });

        startBtn.addEventListener('click', initializeAlgorithm);
        stepBtn.addEventListener('click', performStep);
        resetBtn.addEventListener('click', resetGrid);
        newPuzzleBtn.addEventListener('click', generateNewPuzzle);

        // Edit mode elements
        const playModeBtn = document.getElementById('playModeBtn');
        const editModeBtn = document.getElementById('editModeBtn');
        const editToolbar = document.getElementById('editToolbar');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const editHintText = document.getElementById('editHintText');
        const toastEl = document.getElementById('toast');

        // Edit mode event listeners
        playModeBtn.addEventListener('click', () => setEditMode(false));
        editModeBtn.addEventListener('click', () => setEditMode(true));
        clearAllBtn.addEventListener('click', clearAllWalls);

        // Tool selection
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTool = btn.dataset.tool;
                updateEditHint();
            });
        });

        // Mouse/Touch events for dragging
        document.addEventListener('mouseup', () => isMouseDown = false);
        document.addEventListener('touchend', () => isMouseDown = false);

        // Node class
        class Node {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.g = Infinity;
                this.h = 0;
                this.f = Infinity;
                this.parent = null;
                this.isWall = false;
                this.isStart = false;
                this.isEnd = false;
            }
        }

        // Generate puzzle
        function generateNewPuzzle() {
            const diff = difficulties[currentDifficulty];
            gridSize = diff.size;
            grid = [];
            openList = [];
            closedList = [];
            currentNode = null;
            isRunning = false;
            isComplete = false;
            stepCount = 0;

            // Create empty grid
            for (let y = 0; y < gridSize; y++) {
                grid[y] = [];
                for (let x = 0; x < gridSize; x++) {
                    grid[y][x] = new Node(x, y);
                }
            }

            // Set start and end
            start = grid[0][0];
            start.isStart = true;
            end = grid[gridSize - 1][gridSize - 1];
            end.isEnd = true;

            // Generate walls ensuring path exists
            let attempts = 0;
            let wallsPlaced = 0;
            const maxAttempts = 200;

            while (wallsPlaced < diff.walls && attempts < maxAttempts) {
                const x = Math.floor(Math.random() * gridSize);
                const y = Math.floor(Math.random() * gridSize);

                if (!grid[y][x].isStart && !grid[y][x].isEnd && !grid[y][x].isWall) {
                    grid[y][x].isWall = true;

                    // Check if path still exists
                    if (!pathExists()) {
                        grid[y][x].isWall = false;
                    } else {
                        wallsPlaced++;
                    }
                }
                attempts++;
            }

            renderGrid();
            updateStats();
            updateStepInfo('å‡†å¤‡å¼€å§‹', 'ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"ï¼Œç„¶åç‚¹å‡»"ä¸‹ä¸€æ­¥"æ¥é€æ­¥è§‚å¯ŸA*ç®—æ³•æ˜¯å¦‚ä½•æ‰¾åˆ°æœ€çŸ­è·¯å¾„çš„ï¼');

            startBtn.disabled = false;
            stepBtn.disabled = true;
        }

        // Simple BFS to check if path exists
        function pathExists() {
            const visited = new Set();
            const queue = [[start.x, start.y]];
            visited.add(`${start.x},${start.y}`);

            while (queue.length > 0) {
                const [x, y] = queue.shift();

                if (x === end.x && y === end.y) return true;

                const neighbors = getNeighbors(grid[y][x]);
                for (const neighbor of neighbors) {
                    const key = `${neighbor.x},${neighbor.y}`;
                    if (!visited.has(key) && !neighbor.isWall) {
                        visited.add(key);
                        queue.push([neighbor.x, neighbor.y]);
                    }
                }
            }
            return false;
        }

        // Get neighbors (4-directional)
        function getNeighbors(node) {
            const neighbors = [];
            const dirs = [[0, -1], [1, 0], [0, 1], [-1, 0]]; // Up, Right, Down, Left

            for (const [dx, dy] of dirs) {
                const nx = node.x + dx;
                const ny = node.y + dy;

                if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
                    neighbors.push(grid[ny][nx]);
                }
            }
            return neighbors;
        }

        // Manhattan distance heuristic
        function heuristic(node) {
            return Math.abs(node.x - end.x) + Math.abs(node.y - end.y);
        }

        // Render grid
        function renderGrid() {
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const node = grid[y][x];
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    if (node.isWall) {
                        cell.classList.add('wall');
                        cell.innerHTML = '<span class="cell-icon">ğŸ§±</span>';
                    } else if (node.isStart) {
                        cell.classList.add('start');
                        cell.innerHTML = `
                            <span class="cell-icon">ğŸ¤–</span>
                            ${node.g !== Infinity ? `<span class="cell-values">fâ‰ˆ${node.f}<br>g${node.g}+h*${node.h}</span>` : ''}
                        `;
                    } else if (node.isEnd) {
                        cell.classList.add('end');
                        cell.innerHTML = `
                            <span class="cell-icon">ğŸ </span>
                            ${node.g !== Infinity ? `<span class="cell-values">fâ‰ˆ${node.f}<br>g${node.g}+h*${node.h}</span>` : ''}
                        `;
                    } else if (node === currentNode) {
                        cell.classList.add('current');
                        cell.innerHTML = `
                            <span class="cell-icon">ğŸ‘€</span>
                            <span class="cell-values">fâ‰ˆ${node.f}<br>g${node.g}+h*${node.h}</span>
                        `;
                    } else if (closedList.includes(node)) {
                        cell.classList.add('closed');
                        cell.innerHTML = `
                            <span class="cell-values" style="font-size: 0.7rem;">fâ‰ˆ${node.f}<br>g${node.g}+h*${node.h}</span>
                        `;
                    } else if (openList.includes(node)) {
                        cell.classList.add('open');
                        cell.innerHTML = `
                            <span class="cell-values" style="font-size: 0.7rem;">fâ‰ˆ${node.f}<br>g${node.g}+h*${node.h}</span>
                        `;
                    }

                    // Add edit mode event listeners
                    if (isEditMode) {
                        // Mouse events
                        cell.addEventListener('mousedown', (e) => {
                            e.preventDefault();
                            isMouseDown = true;
                            handleCellEdit(x, y);
                        });
                        cell.addEventListener('mouseenter', () => {
                            handleCellDrag(x, y);
                        });

                        // Touch events
                        cell.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            isMouseDown = true;
                            handleCellEdit(x, y);
                        }, { passive: false });
                        cell.addEventListener('touchmove', (e) => {
                            e.preventDefault();
                            const touch = e.touches[0];
                            const element = document.elementFromPoint(touch.clientX, touch.clientY);
                            if (element && element.classList.contains('cell')) {
                                const cx = parseInt(element.dataset.x);
                                const cy = parseInt(element.dataset.y);
                                handleCellDrag(cx, cy);
                            }
                        }, { passive: false });

                        // Add preview class on hover
                        cell.addEventListener('mouseenter', () => {
                            if (!node.isStart && !node.isEnd && !node.isWall) {
                                cell.classList.add(`preview-${currentTool}`);
                            }
                        });
                        cell.addEventListener('mouseleave', () => {
                            cell.classList.remove('preview-wall', 'preview-start', 'preview-end', 'preview-eraser');
                        });
                    }

                    gridEl.appendChild(cell);
                }
            }
        }

        // Initialize A* algorithm
        function initializeAlgorithm() {
            // Reset node values
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    grid[y][x].g = Infinity;
                    grid[y][x].h = 0;
                    grid[y][x].f = Infinity;
                    grid[y][x].parent = null;
                }
            }

            openList = [];
            closedList = [];
            currentNode = null;
            stepCount = 0;
            isComplete = false;

            // Initialize start node
            start.g = 0;
            start.h = heuristic(start);
            start.f = start.g + start.h;
            openList.push(start);

            isRunning = true;
            startBtn.disabled = true;
            stepBtn.disabled = false;

            renderGrid();
            updateStats();
            updateStepInfo('ç®—æ³•å·²åˆå§‹åŒ– ğŸš€',
                `èµ·ç‚¹çš„å€¼ï¼šg=0ï¼ˆè¿˜æ²¡èµ°ï¼‰, h*â‰ˆ${start.h}ï¼ˆä¹è§‚ä¼°è®¡è¿˜è¦èµ°${start.h}æ­¥ï¼‰, fâ‰ˆ${start.f}ã€‚
                <br>ğŸ’¡ h*æ˜¯å‡è®¾æ²¡æœ‰éšœç¢ç‰©æ—¶çš„æœ€çŸ­è·ç¦»ï¼Œå®é™…å¯èƒ½æ›´è¿œå“¦ï¼
                <br>ç‚¹å‡»"ä¸‹ä¸€æ­¥"ç»§ç»­ï¼`);
        }

        // Perform one step of A*
        function performStep() {
            if (isComplete || openList.length === 0) return;

            stepCount++;

            // Find node with lowest f value
            openList.sort((a, b) => a.f - b.f || a.h - b.h);
            currentNode = openList.shift();
            closedList.push(currentNode);

            // Check if we reached the goal
            if (currentNode === end) {
                isComplete = true;
                showPath();
                return;
            }

            // Get neighbors
            const neighbors = getNeighbors(currentNode);
            let newNodesAdded = [];
            let updatedNodes = [];

            for (const neighbor of neighbors) {
                if (neighbor.isWall || closedList.includes(neighbor)) continue;

                const tentativeG = currentNode.g + 1;

                if (tentativeG < neighbor.g) {
                    neighbor.parent = currentNode;
                    neighbor.g = tentativeG;
                    neighbor.h = heuristic(neighbor);
                    neighbor.f = neighbor.g + neighbor.h;

                    if (!openList.includes(neighbor)) {
                        openList.push(neighbor);
                        newNodesAdded.push(neighbor);
                    } else {
                        updatedNodes.push(neighbor);
                    }
                }
            }

            renderGrid();
            updateStats();

            // Generate step explanation
            let explanation = `æ­£åœ¨æ¢ç´¢ä½ç½® (${currentNode.x}, ${currentNode.y})ï¼Œå®ƒçš„få€¼â‰ˆ${currentNode.f}ï¼ˆä¼°è®¡æœ€å°ï¼ï¼‰`;

            if (newNodesAdded.length > 0) {
                explanation += `<br>å‘ç°äº† ${newNodesAdded.length} ä¸ªæ–°çš„å¯ä»¥èµ°çš„æ ¼å­ï¼Œè®¡ç®—å®ƒä»¬çš„h*ä¼°è®¡å€¼å¹¶åŠ å…¥å¾…æ¢ç´¢åˆ—è¡¨ã€‚`;
            }

            if (openList.length > 0) {
                const best = [...openList].sort((a, b) => a.f - b.f)[0];
                explanation += `<br>ä¸‹ä¸€æ­¥ä¼šæ¢ç´¢få€¼æœ€å°çš„æ ¼å­ (${best.x}, ${best.y})ï¼Œfâ‰ˆ${best.f}`;
            }

            updateStepInfo(`ç¬¬ ${stepCount} æ­¥`, explanation);
        }

        // Show final path
        function showPath() {
            const path = [];
            let node = end;

            while (node) {
                path.unshift(node);
                node = node.parent;
            }

            // Animate path
            let i = 0;
            const animatePath = () => {
                if (i < path.length) {
                    const pathNode = path[i];
                    const cell = gridEl.querySelector(`[data-x="${pathNode.x}"][data-y="${pathNode.y}"]`);
                    if (cell && !pathNode.isStart && !pathNode.isEnd) {
                        cell.className = 'cell path';
                        cell.innerHTML = `
                            <span class="cell-icon">â­</span>
                            <span class="cell-values">fâ‰ˆ${pathNode.f}<br>g${pathNode.g}+h*${pathNode.h}</span>
                        `;
                    }
                    i++;
                    setTimeout(animatePath, 150);
                } else {
                    // Show success modal
                    document.getElementById('pathLength').textContent = path.length - 1;
                    document.getElementById('successMessage').textContent =
                        `æœºå™¨äººç”¨äº† ${stepCount} æ­¥æ¢ç´¢ï¼Œæ‰¾åˆ°äº†é•¿åº¦ä¸º ${path.length - 1} çš„æœ€çŸ­è·¯å¾„ï¼`;
                    document.getElementById('successModal').classList.add('active');

                    updateStepInfo('ğŸ‰ æ‰¾åˆ°æœ€çŸ­è·¯å¾„ï¼',
                        `ç»è¿‡ ${stepCount} æ­¥æ¢ç´¢ï¼Œæ‰¾åˆ°äº†ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯å¾„ï¼
                        <br>è·¯å¾„é•¿åº¦ï¼š${path.length - 1} æ­¥`);
                }
            };

            animatePath();
            stepBtn.disabled = true;
        }

        // Reset grid
        function resetGrid() {
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    grid[y][x].g = Infinity;
                    grid[y][x].h = 0;
                    grid[y][x].f = Infinity;
                    grid[y][x].parent = null;
                }
            }

            openList = [];
            closedList = [];
            currentNode = null;
            isRunning = false;
            isComplete = false;
            stepCount = 0;

            renderGrid();
            updateStats();
            updateStepInfo('å·²é‡ç½® ğŸ”„', 'ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"é‡æ–°å¼€å§‹ï¼Œæˆ–ç‚¹å‡»"æ–°é¢˜ç›®"ç”Ÿæˆæ–°çš„è¿·å®«ï¼');

            startBtn.disabled = false;
            stepBtn.disabled = true;
        }

        // Update statistics
        function updateStats() {
            document.getElementById('stepsCount').textContent = stepCount;
            document.getElementById('openCount').textContent = openList.length;
            document.getElementById('closedCount').textContent = closedList.length;
        }

        // Update step info
        function updateStepInfo(title, message) {
            stepInfo.innerHTML = `
                <h4><i class="fas fa-lightbulb"></i> ${title}
                    ${stepCount > 0 ? `<span class="step-counter">æ­¥éª¤ ${stepCount}</span>` : ''}
                </h4>
                <p>${message}</p>
            `;
        }

        // Modal functions
        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function showHelpModal() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('active');
        }

        // Edit mode functions
        function setEditMode(enabled) {
            isEditMode = enabled;

            // Update buttons
            playModeBtn.classList.toggle('active', !enabled);
            editModeBtn.classList.toggle('active', enabled);

            // Show/hide toolbar
            editToolbar.classList.toggle('visible', enabled);

            // Update grid class
            document.querySelector('.grid-container').classList.toggle('edit-mode', enabled);

            // Reset algorithm state when entering edit mode
            if (enabled && isRunning) {
                resetGrid();
            }

            // Update controls visibility
            document.querySelector('.controls').style.display = enabled ? 'none' : 'flex';
            document.querySelector('.step-info').style.display = enabled ? 'none' : 'block';
            document.querySelector('.speed-control').style.display = enabled ? 'none' : 'flex';

            renderGrid();
        }

        function updateEditHint() {
            const hints = {
                wall: 'ç‚¹å‡»æˆ–æ‹–åŠ¨æ¥æ”¾ç½®/ç§»é™¤éšœç¢ç‰©',
                start: 'ç‚¹å‡»ç©ºç™½æ ¼å­æ¥è®¾ç½®æ–°çš„èµ·ç‚¹',
                end: 'ç‚¹å‡»ç©ºç™½æ ¼å­æ¥è®¾ç½®æ–°çš„ç»ˆç‚¹',
                eraser: 'ç‚¹å‡»æˆ–æ‹–åŠ¨æ¥æ¸…é™¤éšœç¢ç‰©'
            };
            editHintText.textContent = hints[currentTool];
        }

        function clearAllWalls() {
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    grid[y][x].isWall = false;
                }
            }
            renderGrid();
            showToast('å·²æ¸…ç©ºæ‰€æœ‰éšœç¢ç‰©ï¼', 'success');
        }

        function showToast(message, type = 'error') {
            toastEl.textContent = message;
            toastEl.className = 'toast ' + type;
            setTimeout(() => toastEl.classList.add('show'), 10);
            setTimeout(() => toastEl.classList.remove('show'), 2500);
        }

        function handleCellEdit(x, y) {
            if (!isEditMode) return;

            const node = grid[y][x];

            switch (currentTool) {
                case 'wall':
                    if (!node.isStart && !node.isEnd) {
                        node.isWall = !node.isWall;
                    }
                    break;

                case 'start':
                    if (!node.isWall && !node.isEnd) {
                        // Remove old start
                        start.isStart = false;
                        // Set new start
                        node.isStart = true;
                        start = node;
                    }
                    break;

                case 'end':
                    if (!node.isWall && !node.isStart) {
                        // Remove old end
                        end.isEnd = false;
                        // Set new end
                        node.isEnd = true;
                        end = node;
                    }
                    break;

                case 'eraser':
                    if (!node.isStart && !node.isEnd) {
                        node.isWall = false;
                    }
                    break;
            }

            // Check if path still exists
            if (!pathExists()) {
                // Revert the change
                if (currentTool === 'wall' && node.isWall) {
                    node.isWall = false;
                    showToast('âš ï¸ è¿™æ ·æ”¾ä¼šå µæ­»è·¯å“¦ï¼', 'error');
                }
            }

            renderGrid();
        }

        function handleCellDrag(x, y) {
            if (!isEditMode || !isMouseDown) return;

            const node = grid[y][x];

            // Only wall and eraser support dragging
            if (currentTool === 'wall') {
                if (!node.isStart && !node.isEnd && !node.isWall) {
                    node.isWall = true;
                    if (!pathExists()) {
                        node.isWall = false;
                    } else {
                        renderGrid();
                    }
                }
            } else if (currentTool === 'eraser') {
                if (!node.isStart && !node.isEnd && node.isWall) {
                    node.isWall = false;
                    renderGrid();
                }
            }
        }

        // Initialize on load
        generateNewPuzzle();
    </script>
</body>
</html>